#!/bin/bash

echo ==================  Update  =====================
sudo apt-get --assume-yes update

echo ==================  Install HOSTAPD and DNSMASQ  =====================
sudo apt-get --assume-yes install hostapd
sudo apt-get --assume-yes install dnsmasq

echo ==================  CREATE UAP0  =====================
echo ==================  CHECK Exists UAP0  =====================
FOUND=`grep "uap0:" /proc/net/dev`
if [ ! -n "$FOUND" ]
then
	sudo iw dev wlan0 interface add uap0 type __ap
	sudo ip addr add 10.0.27.1/28 dev uap0
fi

echo ==================  Check hostapd.conf  =====================
if [ -f "/etc/hostapd/hostapd.conf" ] && [ ! -f "/etc/hostapd/hostapd.conf.old" ]
then
	sudo mv /etc/hostapd/hostapd.conf /etc/hostapd/hostapd.conf.old
fi

echo ==================  Check dnsmasq.conf  =====================
if [ -f "/etc/dnsmasq.conf" ] && [ ! -f "/etc/dnsmasq.conf.old" ]
then
	sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.old
fi

echo ==================  Check rc.local  =====================
if [ -f "/etc/rc.local" ] && [ ! -f "/etc/rc.local.old" ]
then
	sudo mv /etc/rc.local /etc/rc.local.old
fi

echo ==================  Check hostapdstart  =====================
if [ -f "/usr/local/bin/hostapdstart" ]
then
	sudo rm /usr/local/bin/hostapdstart
fi

echo ==================  Copy configuration files  =====================
sudo cp hostapd.conf /etc/hostapd/hostapd.conf
sudo cp dnsmasq.conf /etc/dnsmasq.conf
sudo cp dhcpcd.conf /etc/dhcpcd.conf
sudo cp hostapdstart /usr/local/bin/hostapdstart

echo ==================  CHMOD hostapdstart  =====================
sudo chmod 667 /usr/local/bin/hostapdstart



